"use strict";(self["webpackChunkweather_project_vue3"]=self["webpackChunkweather_project_vue3"]||[]).push([[163],{4751:function(e,t,n){n.r(t),n.d(t,{default:function(){return _}});var s=n(6768),a=n(4232);const o={ref:"canvas"},i={class:"dropdown-wrap"};function r(e,t,n,r,c,l){const p=(0,s.g2)("CustomDropdown");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("h1",null,"Карта "+(0,a.v_)(e.layerTitle),1),(0,s.Lk)("div",{class:"map-wrap",onMousedown:t[0]||(t[0]=(...t)=>e.startDrag&&e.startDrag(...t)),onMousemove:t[1]||(t[1]=(...t)=>e.onDrag&&e.onDrag(...t)),onMouseup:t[2]||(t[2]=(...t)=>e.endDrag&&e.endDrag(...t)),onMouseleave:t[3]||(t[3]=(...t)=>e.onMouseLeave&&e.onMouseLeave(...t)),onTouchstart:t[4]||(t[4]=(...t)=>e.startDrag&&e.startDrag(...t)),onTouchmove:t[5]||(t[5]=(...t)=>e.onDrag&&e.onDrag(...t)),onTouchend:t[6]||(t[6]=(...t)=>e.endDrag&&e.endDrag(...t)),onTouchcancel:t[7]||(t[7]=(...t)=>e.onTouchCancel&&e.onTouchCancel(...t))},[(0,s.Lk)("canvas",o,null,512),(0,s.Lk)("div",i,[(0,s.bF)(p,{onChange:e.onSelectOption,options:e.options,selected:"Выбрать карту"},null,8,["onChange","options"])])],32),t[8]||(t[8]=(0,s.Lk)("div",{class:"map-caption"},[(0,s.Lk)("span",null,"Источник карты мира: OpenStreetMap.org")],-1))],64)}n(8111),n(2489),n(1701);function c(e,t){let n,s=!0;return function(...a){const o=this;s&&(s=!1,e.apply(o,a),n=setTimeout(()=>{s=!0},t))}}const l=[{id:1,name_ru:"осадки",name_en:"precipitation_new"},{id:2,name_ru:"облака",name_en:"clouds_new"},{id:3,name_ru:"давление",name_en:"pressure_new"},{id:4,name_ru:"скорость ветра",name_en:"wind_new"},{id:5,name_ru:"температура",name_en:"temp_new"}],p={class:"select-wrap"},h=["onClick"];function u(e,t,n,o,i,r){return(0,s.uX)(),(0,s.CE)("div",p,[(0,s.Lk)("div",{class:(0,a.C4)(["select-wrap__selected",{open:e.open}]),onClick:t[0]||(t[0]=(...t)=>e.toggleOpen&&e.toggleOpen(...t))},(0,a.v_)(e.selectedValue),3),(0,s.Lk)("div",{class:(0,a.C4)(["select-wrap__items-list",{selectHide:!e.open}])},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.options,(t,n)=>((0,s.uX)(),(0,s.CE)("div",{class:"select-wrap__item",key:n,onClick:n=>e.selectOption(t)},(0,a.v_)(t),9,h))),128))],2)])}var d=(0,s.pM)({name:"CustomDropdown",props:{options:{type:Array,required:!0},selected:{type:String,required:!1,default:"Выбрать"}},data(){return{open:!1,selectedValue:this.selected}},methods:{selectOption(e){this.selectedValue=e,this.open=!1,this.$emit("change",e)},toggleOpen(){this.open=!this.open}}}),f=n(1241);const g=(0,f.A)(d,[["render",u],["__scopeId","data-v-7029fe34"]]);var m=g,w=(0,s.pM)({name:"Map",components:{CustomDropdown:m},data(){return{apiKey:"36b59a428ae07106b683317f19604659",layer:"precipitation_new",z:3,tileSize:256,isDragging:!1,offsetX:0,offsetY:0,lastX:0,lastY:0,options:l.map(e=>e.name_ru.charAt(0).toUpperCase()+e.name_ru.slice(1))}},methods:{async renderMap(){const{z:e,layer:t,apiKey:n,tileSize:s}=this,a=Math.pow(2,e),o=this.$refs.canvas;if(!o)return;const i=o.getContext("2d");if(i){o.width=s*a,o.height=s*(a-2),console.log(`Рисуем карту: z=${e}, тайлов=${a**2}`);for(let t=0;t<a;t++)for(let n=1;n<a-1;n++){const s=`https://tile.openstreetmap.org/${e}/${t}/${n}.png`;await this.drawTile(i,s,t,n-1)}for(let s=0;s<a;s++)for(let o=1;o<a-1;o++){const a=`https://tile.openweathermap.org/map/${t}/${e}/${s}/${o}.png?appid=${n}`;await this.drawTile(i,a,s,o-1)}console.log("Карта готова")}},async drawTile(e,t,n,s){return new Promise((a,o)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>{e.globalAlpha=1,e.drawImage(i,n*this.tileSize,s*this.tileSize),e.globalAlpha=1,a()},i.onerror=o,i.src=t})},startDrag(e){this.isDragging=!0;const t=e instanceof TouchEvent?e.touches[0]:e;this.lastX=t.clientX,this.lastY=t.clientY},onDrag(e){if(!this.isDragging)return;const t=e instanceof TouchEvent?e.touches[0]:e,n=t.clientX-this.lastX,s=t.clientY-this.lastY;this.lastX=t.clientX,this.lastY=t.clientY,this.offsetX+=n,this.offsetY+=s,this.canvasSizeTransform()},endDrag(){this.isDragging=!1},canvasSizeTransform(){const e=this.$refs.canvas,t=e.parentElement,n=e.clientWidth,s=e.clientHeight,a=t.clientWidth,o=t.clientHeight,i=0,r=a-n,c=0,l=o-s;this.offsetX<r&&(this.offsetX=r),this.offsetX>i&&(this.offsetX=i),this.offsetY<l&&(this.offsetY=l),this.offsetY>c&&(this.offsetY=c),e.style.transform=`translate(${this.offsetX}px, ${this.offsetY}px)`},onMouseLeave(){this.isDragging&&this.endDrag()},onTouchCancel(){this.onMouseLeave()},onSelectOption(e){l.filter(t=>{t.name_ru.toLowerCase()===e.toLowerCase()&&(this.layer=t.name_en)})}},mounted(){this.renderMap(),this.onDrag=c(this.onDrag,50),this.canvasSizeTransform=c(this.canvasSizeTransform,50),window.addEventListener("resize",this.canvasSizeTransform)},activated(){window.addEventListener("resize",this.canvasSizeTransform)},deactivated(){window.removeEventListener("resize",this.canvasSizeTransform)},computed:{layerTitle(){switch(this.layer){case"precipitation_new":return"осадков";case"clouds_new":return"облаков";case"pressure_new":return"давления на уровне моря";case"wind_new":return"скорости ветра";case"temp_new":return"температуры";default:return""}}},watch:{layer(){this.renderMap()}}});const v=(0,f.A)(w,[["render",r],["__scopeId","data-v-70776780"]]);var _=v}}]);
//# sourceMappingURL=map.c253db4d.js.map