{"version":3,"file":"js/map.84bc815f.js","mappings":"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","sources":["webpack://weather-project-vue3/./src/views/Map.vue?b401","webpack://weather-project-vue3/./src/views/Map.vue","webpack://weather-project-vue3/./src/utils/throttle.ts","webpack://weather-project-vue3/./src/assets/mapsList.ts","webpack://weather-project-vue3/./src/components/UI/CustomDropdown.vue?cebf","webpack://weather-project-vue3/./src/components/UI/CustomDropdown.vue","webpack://weather-project-vue3/./src/components/UI/CustomDropdown.vue?692c","webpack://weather-project-vue3/./src/views/Map.vue?0d41"],"sourcesContent":["import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nconst _hoisted_1 = { ref: \"canvas\" }\nconst _hoisted_2 = { class: \"dropdown-wrap\" }\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_CustomDropdown = _resolveComponent(\"CustomDropdown\")!\n\n  return (_openBlock(), _createElementBlock(_Fragment, null, [\n    _createElementVNode(\"h1\", null, \"Карта \" + _toDisplayString(_ctx.layerTitle), 1),\n    _createElementVNode(\"div\", {\n      class: \"map-wrap\",\n      onMousedown: _cache[0] || (_cache[0] = \n//@ts-ignore\n(...args) => (_ctx.startDrag && _ctx.startDrag(...args))),\n      onMousemove: _cache[1] || (_cache[1] = \n//@ts-ignore\n(...args) => (_ctx.onDrag && _ctx.onDrag(...args))),\n      onMouseup: _cache[2] || (_cache[2] = \n//@ts-ignore\n(...args) => (_ctx.endDrag && _ctx.endDrag(...args))),\n      onMouseleave: _cache[3] || (_cache[3] = \n//@ts-ignore\n(...args) => (_ctx.onMouseLeave && _ctx.onMouseLeave(...args))),\n      onTouchstart: _cache[4] || (_cache[4] = \n//@ts-ignore\n(...args) => (_ctx.startDrag && _ctx.startDrag(...args))),\n      onTouchmove: _cache[5] || (_cache[5] = \n//@ts-ignore\n(...args) => (_ctx.onDrag && _ctx.onDrag(...args))),\n      onTouchend: _cache[6] || (_cache[6] = \n//@ts-ignore\n(...args) => (_ctx.endDrag && _ctx.endDrag(...args))),\n      onTouchcancel: _cache[7] || (_cache[7] = \n//@ts-ignore\n(...args) => (_ctx.onTouchCancel && _ctx.onTouchCancel(...args)))\n    }, [\n      _createElementVNode(\"canvas\", _hoisted_1, null, 512),\n      _createElementVNode(\"div\", _hoisted_2, [\n        _createVNode(_component_CustomDropdown, {\n          onChange: _ctx.onSelectOption,\n          options: _ctx.options,\n          selected: \"Выбрать карту\"\n        }, null, 8, [\"onChange\", \"options\"])\n      ])\n    ], 32),\n    _cache[8] || (_cache[8] = _createElementVNode(\"div\", { class: \"map-caption\" }, [\n      _createElementVNode(\"span\", null, \"Источник карты мира: OpenStreetMap.org\")\n    ], -1))\n  ], 64))\n}","<template>\n  <h1>Карта {{ layerTitle }}</h1>\n  <div\n    class=\"map-wrap\"\n    @mousedown=\"startDrag\"\n    @mousemove=\"onDrag\"\n    @mouseup=\"endDrag\"\n    @mouseleave=\"onMouseLeave\"\n    @touchstart=\"startDrag\"\n    @touchmove=\"onDrag\"\n    @touchend=\"endDrag\"\n    @touchcancel=\"onTouchCancel\"\n  >\n    <canvas ref=\"canvas\"></canvas>\n    <div class=\"dropdown-wrap\">\n      <CustomDropdown @change=\"onSelectOption\" :options=\"options\" selected=\"Выбрать карту\" />\n    </div>\n  </div>\n  <div class=\"map-caption\">\n    <span>Источник карты мира: OpenStreetMap.org</span>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\nimport { throttle } from \"@/utils/throttle\";\nimport { mapsList } from \"@/assets/mapsList\";\nimport CustomDropdown from \"@/components/UI/CustomDropdown.vue\";\n\nexport default defineComponent({\n  name: \"Map\",\n  components: { CustomDropdown },\n  data() {\n    return {\n      apiKey: process.env.VUE_APP_OPENWEATHER_API_KEY as string,\n      layer: \"precipitation_new\" as string,\n      z: 3 as number, //уровень зума, оптимальный для всей Земли\n      tileSize: 256 as number,\n      isDragging: false as boolean,\n      offsetX: 0 as number,\n      offsetY: 0 as number,\n      lastX: 0 as number,\n      lastY: 0 as number,\n      //перебираю массив объектов и получаю массив с названиями на русском + делаю первую букву заглавной\n      options: mapsList.map((item) => item.name_ru.charAt(0).toUpperCase() + item.name_ru.slice(1)),\n    };\n  },\n  methods: {\n    async renderMap(): Promise<void> {\n      const { z, layer, apiKey, tileSize } = this;\n      const tilesPerAxis = Math.pow(2, z); //при z=2, будет 16 тайлов, при z=3 - 64 тайла\n      const canvas = this.$refs.canvas as HTMLCanvasElement | undefined;\n      if (!canvas) return;\n\n      const ctx = canvas.getContext(\"2d\");\n      if (!ctx) return;\n\n      //Размер итогового canvas\n      canvas.width = tileSize * tilesPerAxis;\n      canvas.height = tileSize * (tilesPerAxis - 2);\n\n      console.log(`Рисуем карту: z=${z}, тайлов=${tilesPerAxis ** 2}`);\n\n      //подготовка OSM подложки - начинаю с первого и заканчиваю на один меньше, чтобы карта была прямоугольной\n      for (let x = 0; x < tilesPerAxis; x++) {\n        for (let y = 1; y < tilesPerAxis - 1; y++) {\n          const osmUrl = `https://tile.openstreetmap.org/${z}/${x}/${y}.png`;\n          await this.drawTile(ctx, osmUrl, x, y - 1);\n        }\n      }\n\n      //Загрузка тайлов для слоя погоды - поверх подложки - начинаю с первого и заканчиваю на один меньше, чтобы карта была прямоугольной\n      for (let x = 0; x < tilesPerAxis; x++) {\n        for (let y = 1; y < tilesPerAxis - 1; y++) {\n          const url = `https://tile.openweathermap.org/map/${layer}/${z}/${x}/${y}.png?appid=${apiKey}`;\n          await this.drawTile(ctx, url, x, y - 1);\n        }\n      }\n\n      console.log(\"Карта готова\");\n    },\n    async drawTile(ctx: CanvasRenderingContext2D, url: string, x: number, y: number): Promise<void> {\n      return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.crossOrigin = \"anonymous\";\n        img.onload = () => {\n          ctx.globalAlpha = 1;\n          ctx.drawImage(img, x * this.tileSize, y * this.tileSize);\n          ctx.globalAlpha = 1;\n          resolve();\n        };\n        img.onerror = reject;\n        img.src = url;\n      });\n    },\n    startDrag(event: MouseEvent | TouchEvent) {\n      this.isDragging = true;\n\n      //проверка - тач или мышь\n      const point = event instanceof TouchEvent ? event.touches[0] : event;\n\n      this.lastX = point.clientX;\n      this.lastY = point.clientY;\n    },\n    onDrag(event: MouseEvent | TouchEvent) {\n      if (!this.isDragging) return;\n\n      const point = event instanceof TouchEvent ? event.touches[0] : event;\n\n      const dx = point.clientX - this.lastX;\n      const dy = point.clientY - this.lastY;\n      this.lastX = point.clientX;\n      this.lastY = point.clientY;\n      this.offsetX += dx;\n      this.offsetY += dy;\n\n      const canvas = this.$refs.canvas as HTMLCanvasElement;\n      const wrapper = canvas.parentElement as HTMLElement;\n\n      const canvasWidth = canvas.clientWidth;\n      const canvasHeight = canvas.clientHeight;\n\n      const wrapWidth = wrapper.clientWidth;\n      const wrapHeight = wrapper.clientHeight;\n\n      //ограничение по горизонтали\n      const maxOffsetX = 0;\n      const minOffsetX = wrapWidth - canvasWidth;\n\n      //ограничение по вертикали\n      const maxOffsetY = 0;\n      const minOffsetY = wrapHeight - canvasHeight;\n\n      if (this.offsetX < minOffsetX) {\n        this.offsetX = minOffsetX;\n      } else if (this.offsetX > maxOffsetX) {\n        this.offsetX = maxOffsetX;\n      }\n\n      if (this.offsetY < minOffsetY) {\n        this.offsetY = minOffsetY;\n      } else if (this.offsetY > maxOffsetY) {\n        this.offsetY = maxOffsetY;\n      }\n\n      canvas.style.transform = `translate(${this.offsetX}px, ${this.offsetY}px)`;\n    },\n    endDrag() {\n      this.isDragging = false;\n    },\n    onResize() {\n      const canvas = this.$refs.canvas as HTMLCanvasElement;\n      const wrapper = canvas.parentElement as HTMLElement;\n\n      const canvasWidth = canvas.clientWidth;\n      const canvasHeight = canvas.clientHeight;\n\n      const wrapperWidth = wrapper.clientWidth;\n      const wrapperHeight = wrapper.clientHeight;\n\n      const maxOffsetX = 0;\n      const minOffsetX = wrapperWidth - canvasWidth;\n\n      const maxOffsetY = 0;\n      const minOffsetY = wrapperHeight - canvasHeight;\n\n      if (this.offsetX < minOffsetX) {\n        this.offsetX = minOffsetX;\n      }\n      if (this.offsetX > maxOffsetX) {\n        this.offsetX = maxOffsetX;\n      }\n      if (this.offsetY < minOffsetY) {\n        this.offsetY = minOffsetY;\n      }\n      if (this.offsetY > maxOffsetY) {\n        this.offsetY = maxOffsetY;\n      }\n      canvas.style.transform = `translate(${this.offsetX}px, ${this.offsetY}px)`;\n    },\n    onMouseLeave() {\n      if (this.isDragging) {\n        this.endDrag();\n      }\n    },\n    onTouchCancel() {\n      this.onMouseLeave();\n    },\n    onSelectOption(value: string) {\n      //фильтрую массив объектов, нахожу элемент, у которого название на русском соответствует тому, что пришло по клику из emit\n      mapsList.filter((item) => {\n        if (item.name_ru.toLowerCase() === value.toLowerCase()) {\n          this.layer = item.name_en;\n        }\n      });\n    },\n  },\n  mounted() {\n    this.renderMap();\n    this.onDrag = throttle(this.onDrag, 50);\n    this.onResize = throttle(this.onResize, 100);\n    window.addEventListener(\"resize\", this.onResize);\n  },\n  activated() {\n    window.addEventListener(\"resize\", this.onResize);\n  },\n  deactivated() {\n    window.removeEventListener(\"resize\", this.onResize);\n  },\n  computed: {\n    layerTitle(): string {\n      switch (this.layer) {\n        case \"precipitation_new\":\n          return \"осадков\";\n        case \"clouds_new\":\n          return \"облаков\";\n        case \"pressure_new\":\n          return \"давления на уровне моря\";\n        case \"wind_new\":\n          return \"скорости ветра\";\n        case \"temp_new\":\n          return \"температуры\";\n        default:\n          return \"\";\n      }\n    },\n  },\n  watch: {\n    layer() {\n      this.renderMap();\n    },\n  },\n});\n</script>\n\n<style scoped lang=\"scss\">\n.map-wrap {\n  max-width: 1000px;\n  width: 100%;\n  margin: 0 auto;\n  aspect-ratio: 1/0.65;\n  border: 2px solid #333;\n  overflow: hidden;\n  position: relative;\n  background: #818b90;\n  cursor: grab;\n\n  @include medium {\n    aspect-ratio: 1/0.75;\n  }\n\n  @include small {\n    aspect-ratio: 1/1;\n  }\n\n  @include x-small {\n    aspect-ratio: 1/1.25;\n  }\n\n  &:active {\n    cursor: grabbing;\n  }\n}\n\n.dropdown-wrap {\n  position: absolute;\n  top: 8px;\n  right: 6px;\n  z-index: 10;\n}\n\ncanvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 1;\n  transition: transform 0s;\n  image-rendering: pixelated;\n}\n\n.map-caption {\n  margin: 30px 0 20px 0;\n  font-size: 22px;\n  line-height: 110%;\n}\n</style>\n","export function throttle(func: (...args: any[]) => void, delay: number) {\n  //ID таймера\n  let timeoutId: number | null;\n  //флаг - разрешение вызова функции\n  let canRun: boolean = true;\n\n  return function (this: any, ...args: any[]) {\n    //сохраняю контекст вызова\n    const context = this;\n\n    if (!canRun) {\n      return;\n    }\n\n    //запрет на вызов, пока таймер не истечет\n    canRun = false;\n    func.apply(context, args);\n\n    timeoutId = setTimeout(() => {\n      //разрешение вызова после задержки\n      canRun = true;\n    }, delay);\n  };\n}\n","const mapsList: Array<Record<string, any>> = [\n  {\n    id: 1,\n    name_ru: \"осадки\",\n    name_en: \"precipitation_new\",\n  },\n  {\n    id: 2,\n    name_ru: \"облака\",\n    name_en: \"clouds_new\",\n  },\n  {\n    id: 3,\n    name_ru: \"давление\",\n    name_en: \"pressure_new\",\n  },\n  {\n    id: 4,\n    name_ru: \"скорость ветра\",\n    name_en: \"wind_new\",\n  },\n  {\n    id: 5,\n    name_ru: \"температура\",\n    name_en: \"temp_new\",\n  },\n];\n\nexport { mapsList };\n","import { toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nconst _hoisted_1 = { class: \"select-wrap\" }\nconst _hoisted_2 = [\"onClick\"]\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createElementVNode(\"div\", {\n      class: _normalizeClass([\"select-wrap__selected\", { open: _ctx.open }]),\n      onClick: _cache[0] || (_cache[0] = \n//@ts-ignore\n(...args) => (_ctx.toggleOpen && _ctx.toggleOpen(...args)))\n    }, _toDisplayString(_ctx.selectedValue), 3),\n    _createElementVNode(\"div\", {\n      class: _normalizeClass([\"select-wrap__items-list\", { selectHide: !_ctx.open }])\n    }, [\n      (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.options, (option, i) => {\n        return (_openBlock(), _createElementBlock(\"div\", {\n          class: \"select-wrap__item\",\n          key: i,\n          onClick: ($event: any) => (_ctx.selectOption(option))\n        }, _toDisplayString(option), 9, _hoisted_2))\n      }), 128))\n    ], 2)\n  ]))\n}","<template>\n  <div class=\"select-wrap\">\n    <div class=\"select-wrap__selected\" :class=\"{ open: open }\" @click=\"toggleOpen\">{{ selectedValue }}</div>\n    <div class=\"select-wrap__items-list\" :class=\"{ selectHide: !open }\">\n      <div class=\"select-wrap__item\" v-for=\"(option, i) of options\" :key=\"i\" @click=\"selectOption(option)\">\n        {{ option }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\n\nexport default defineComponent({\n  name: \"CustomDropdown\",\n  props: {\n    options: {\n      type: Array,\n      required: true,\n    },\n    selected: {\n      type: String,\n      required: false,\n      default: \"Выбрать\",\n    },\n  },\n  data() {\n    return {\n      open: false,\n      selectedValue: this.selected,\n    };\n  },\n  methods: {\n    selectOption(option: string): void {\n      this.selectedValue = option;\n      this.open = false;\n      this.$emit(\"change\", option);\n    },\n    toggleOpen() {\n      this.open = !this.open;\n    },\n  },\n});\n</script>\n\n<style scoped lang=\"scss\">\n.select-wrap {\n  position: relative;\n  width: 180px;\n  outline: none;\n  text-align: left;\n\n  &__selected {\n    padding: 8px 16px;\n    border-radius: 6px;\n    background: rgba(129, 139, 144, 0.35);\n    cursor: pointer;\n    font-size: 18px;\n    font-weight: 500;\n    line-height: 110%;\n    transition: background-color 0.3s;\n\n    &.open {\n      background: rgba(32, 44, 57, 0.35);\n      border-radius: 6px 6px 0 0;\n      border-bottom: 1px solid #101910;\n    }\n  }\n\n  &__items-list {\n    position: absolute;\n    width: 100%;\n    background: rgba(129, 139, 144, 0.35);\n    box-sizing: border-box;\n    padding: 2px 8px 8px 8px;\n    font-size: 18px;\n    line-height: 110%;\n    cursor: pointer;\n  }\n\n  &__item {\n    border-bottom: 1px solid #42465a;\n    padding: 4px 0;\n  }\n}\n\n.selectHide {\n  display: none;\n}\n</style>\n","import { render } from \"./CustomDropdown.vue?vue&type=template&id=7029fe34&scoped=true&ts=true\"\nimport script from \"./CustomDropdown.vue?vue&type=script&lang=ts\"\nexport * from \"./CustomDropdown.vue?vue&type=script&lang=ts\"\n\nimport \"./CustomDropdown.vue?vue&type=style&index=0&id=7029fe34&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-7029fe34\"]])\n\nexport default __exports__","import { render } from \"./Map.vue?vue&type=template&id=4dca4267&scoped=true&ts=true\"\nimport script from \"./Map.vue?vue&type=script&lang=ts\"\nexport * from \"./Map.vue?vue&type=script&lang=ts\"\n\nimport \"./Map.vue?vue&type=style&index=0&id=4dca4267&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-4dca4267\"]])\n\nexport default __exports__"],"names":["_hoisted_1","ref","_hoisted_2","class","render","_ctx","_cache","$props","$setup","$data","$options","_component_CustomDropdown","_resolveComponent","_openBlock","_createElementBlock","_Fragment","_createElementVNode","_toDisplayString","layerTitle","onMousedown","args","startDrag","onMousemove","onDrag","onMouseup","endDrag","onMouseleave","onMouseLeave","onTouchstart","onTouchmove","onTouchend","onTouchcancel","onTouchCancel","_createVNode","onChange","onSelectOption","options","selected","throttle","func","delay","timeoutId","canRun","context","this","apply","setTimeout","mapsList","id","name_ru","name_en","_normalizeClass","open","onClick","toggleOpen","selectedValue","selectHide","_renderList","option","i","key","$event","selectOption","defineComponent","name","props","type","Array","required","String","default","data","methods","$emit","__exports__","components","CustomDropdown","apiKey","process","layer","z","tileSize","isDragging","offsetX","offsetY","lastX","lastY","map","item","charAt","toUpperCase","slice","renderMap","tilesPerAxis","Math","pow","canvas","$refs","ctx","getContext","width","height","console","log","x","y","osmUrl","drawTile","url","Promise","resolve","reject","img","Image","crossOrigin","onload","globalAlpha","drawImage","onerror","src","event","point","TouchEvent","touches","clientX","clientY","dx","dy","wrapper","parentElement","canvasWidth","clientWidth","canvasHeight","clientHeight","wrapWidth","wrapHeight","maxOffsetX","minOffsetX","maxOffsetY","minOffsetY","style","transform","onResize","wrapperWidth","wrapperHeight","value","filter","toLowerCase","mounted","window","addEventListener","activated","deactivated","removeEventListener","computed","watch"],"sourceRoot":""}